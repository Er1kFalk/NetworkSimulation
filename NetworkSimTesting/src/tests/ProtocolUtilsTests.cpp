#include "ProtocolUtilsTests.h"
#include "../../../NetworkSimulation/src/UtilityLibraries/ProtocolUtils/ProtocolUtils.h"
#include <gtest/gtest.h>
#include <gmock/gmock.h>
#include <vector>

TEST(ProtocolUtils, calculateCorrectInternetChecksum) {
    std::vector<unsigned char> multiple_of_16_test = {0x45, 0x00, 0x00, 0x73, 0x00, 0x00, 0x40, 0x00, 0x40, 0x11, 0xc0, 0xa8, 0x00, 0x01, 0xc0, 0xa8, 0x00, 0xc7};
    std::vector<unsigned char> not_multiple_of_16_test = {0x45, 0x00, 0x00, 0x73, 0x00, 0x00, 0x40, 0x00, 0x40, 0x11, 0xc0, 0xa8, 0x00, 0x01, 0xc0, 0xa8, 0x00, 0xc7, 0x12};


    EXPECT_EQ(ProtocolUtils::calculate_internet_checksum(multiple_of_16_test), 0xb861);
    EXPECT_EQ(ProtocolUtils::calculate_internet_checksum(not_multiple_of_16_test), 0xb84f);
}

TEST(ProtocolUtils, verifyCorrectInternetChecksum) {
    std::vector<unsigned char> multiple_of_16_test = {0x45, 0x00, 0x00, 0x73, 0x00, 0x00, 0x40, 0x00, 0x40, 0x11, 0xc0, 0xa8, 0x00, 0x01, 0xc0, 0xa8, 0x00, 0xc7};
    std::vector<unsigned char> not_multiple_of_16_test = {0x45, 0x00, 0x00, 0x73, 0x00, 0x00, 0x40, 0x00, 0x40, 0x11, 0xc0, 0xa8, 0x00, 0x01, 0xc0, 0xa8, 0x00, 0xc7, 0x12};


    EXPECT_TRUE(ProtocolUtils::verify_internet_checksum(multiple_of_16_test, 0xb861));
    EXPECT_TRUE(ProtocolUtils::verify_internet_checksum(not_multiple_of_16_test, 0xb84f));
}
